ðŸ“˜ DOCUMENTACIÃ“N OFICIAL â€“ PORTAL TAUREL
(100 % compatible con Capacitor, sin frameworks pesados)
DESCRIPCIÃ“N GENERAL
Portal Taurel es una PWA hÃ­brida (web + Android/iOS via Capacitor) que permite a usuarios y clientes consultar el estado de sus envÃ­os marÃ­timos en tiempo real:
â€¢ Login automÃ¡tico con credenciales fijas de integraciÃ³n
â€¢ Listado y bÃºsqueda local de shipments (MBL, HBL, ID, referencia)
â€¢ VisualizaciÃ³n de ruta, paradas, contenedores y Ãºltimos eventos
â€¢ Mapa interactivo con posiciÃ³n AIS del buque (origen â†’ barco â†’ destino)
â€¢ BotÃ³n â€œVer climaâ€ que muestra temperatura, viento y oleaje (Open-Meteo)
â€¢ Notificaciones push de alertas meteorolÃ³gicas (opcional)
Todo sin librerÃ­as pesadas: vanilla JS, Leaflet, Capacitor Plugins.


ARQUITECTURA Y FLUJO DE DATOS
(1) Arranque
DOMContentLoaded â†’ Capacitor (Splash + StatusBar) â†’ login()
(2) AutenticaciÃ³n
POST https://taurel.cargologik.app/api/v2/users/login
Body: {email: "integration@taurel.com", password: "QGd0EX59of3aVP3M"}
Guarda window.token para usar en endpoints posteriores.
(3) Carga masiva de shipments
POST /shipments
Body: {limit: 300, page: 1, filter: {}, fields: [...]}
Respuesta â†’ allShipments[] (array global)
(4) BÃºsqueda local
searchAny() â†’ filtra por shipmentId, mbl, hbl, referenceName (upper-case)
(5) Mapas y AIS
â€¢ Por cada shipment: events[] con coordinates â†’ origen/destino
â€¢ Nombre del buque â†’ /vessels/search â†’ IMO
â€¢ /vessels/{IMO}/positions â†’ lat, lon, timestamp â†’ marcador ðŸš¢
â€¢ Leaflet dibuja lÃ­nea origen-barco-destino y ajusta vista.
(6) Clima
BotÃ³n â€œVer climaâ€ â†’ Open-Meteo (sin key)
Fallback de coordenadas: lastKnownLocation â†’ origin â†’ destination â†’ primer evento con location.
(7) Alertas push (weather-alerts.js)
Cada 30 min: Ãºltimo shipment con coordenadas â†’ OpenWeather (key gratuita) â†’ si viento > 15 m/s â†’ notificaciÃ³n push por Capacitor.


ESTRUCTURA DE ARCHIVOS
index.html
â€ƒâ”œâ”€ style.css (UI glassmorphism + glassmorphism loader)
â€ƒâ”œâ”€ script.js (lÃ³gica principal, mapas, clima)
â€ƒâ”œâ”€ weather-alerts.js (loop de alertas push â€“ opcional)
â€ƒâ”œâ”€ manifest.json (PWA)
â€ƒâ”œâ”€ capacitor.config.json
â€ƒâ””â”€ package.json + package-lock.json (Capacitor 7 + Leaflet)


ENDPOINTS UTILIZADOS
Base: https://taurel.cargologik.app/api/v2
POST /users/login
POST /shipments
GET /vessels/search?name={nombre}
GET /vessels/{IMO}/positions
Externos:
GET https://api.open-meteo.com/v1/forecast?latitude=...&longitude=...&current_weather=true&timezone=auto
GET https://api.openweathermap.org/data/2.5/weather?lat=...&lon=...&appid={KEY} (alertas)


FORMATO DE COORDENADAS
â€¢ Lat/lng siempre como nÃºmero (parseFloat).
â€¢ toFixed(4) antes de llamar Open-Meteo (evita 400).
â€¢ Orden de preferencia para â€œVer climaâ€:
â€ƒ1. lastKnownLocation.lat/lon
â€ƒ2. origin.lat/lng
â€ƒ3. destination.lat/lng
â€ƒ4. events[n].location.lat/lon (primer match)


MAPAS â€“ LEAFLET
â€¢ Capa base: OpenStreetMap.
â€¢ Iconos:
â€ƒðŸŸ¢ Verde â†’ origen
â€ƒðŸ”´ Rojo â†’ destino
â€ƒðŸš¢ DivIcon HTML â†’ barco (Ãºltima posiciÃ³n AIS)
â€¢ LÃ­nea azul continua: origen â†’ barco â†’ destino.
â€¢ LÃ­nea azul punteada: paradas intermedias (events con coords).
â€¢ map.fitBounds(polyline.getBounds().pad(0.1)) auto-zoom.


ESTILOS Y RESPONSIVE
â€¢ 1 rem = 10 px (html 62.5 %).
â€¢ Glassmorphism: fondo animado radial-gradient + backdrop-filter.
â€¢ #map height: 50 vh (mÃ­n. 300 px).
â€¢ Media-query â‰¤ 600 px: reduce altura del mapa y tamaÃ±o de letra.
â€¢ Loader centrado: overlay fijo con spinner CSS.


CAPACITOR â€“ CONFIGURACIÃ“N CLAVE
appId: com.taurel.shipping
webDir: www
Plugins usados:
â€¢ SplashScreen: se oculta tras DOMContentLoaded.
â€¢ StatusBar: color #00529b, estilo LIGHT.
â€¢ PushNotifications: canal â€œweatherâ€ para alertas.


Build Android:
npm install
npx cap sync android
npx cap open android
Luego Build â†’ Build Bundle(s)/APK(s) en Android Studio.


NOTIFICACIONES PUSH (OPCIONAL)
weather-alerts.js se carga despuÃ©s de script.js.
Requiere clave gratuita de OpenWeather.
Crea canal â€œweatherâ€ y programa notificaciÃ³n local si viento > 15 m/s.
No interfere con el resto de la app: si no hay key o falla, no crashea.


SEGURIDAD Y GOOD PRACTICES
â€¢ Credenciales fijas solo para integraciÃ³n; en producciÃ³n usar OAuth o token dinÃ¡mico.
â€¢ ValidaciÃ³n de NaN y null en coordenadas antes de fetch.
â€¢ Sin eval(), innerHTML solo en templates controlados.
â€¢ fetch con try/catch y comprobaciÃ³n de res.ok.
â€¢ CSS encapsulado en :root y clases semÃ¡nticas.


EXTENSIBILIDAD FUTURA
â€¢ Sustituir login fijo por formulario OAuth.
â€¢ Agregar selector de idioma (i18n).
â€¢ Cachear shipments en IndexedDB para offline.
â€¢ WebSockets para posiciÃ³n en tiempo real.
â€¢ GrÃ¡ficos de temperatura/oleaje con Chart.js.
â€¢ Publicar en Play Store: firmar APK, subir imagenes 512Ã—512, 1024Ã—500, polÃ­tica de privacidad.


TROUBLESHOOTING RÃPIDO
BotÃ³n â€œVer climaâ€ no aparece â†’ console.log(found) y revisar orden de fallback.
400 en Open-Meteo â†’ revisar decimales (mÃ¡x. 4) y quitar parÃ¡metros marinos si se usa tierra firme.
Mapa gris â†’ asegurar setTimeout(() => map.invalidateSize(), 100) tras crear el div.
Push no llega â†’ verificar canal creado, icono ic_stat_weather en res/drawable, y permisos POST_NOTIFICATIONS en AndroidManifest.